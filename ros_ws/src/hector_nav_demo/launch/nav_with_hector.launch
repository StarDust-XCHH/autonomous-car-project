<launch>
  <arg name="map_resolution" default="0.02" />
  <arg name="base_frame" default="base_link" />
  <arg name="laser_topic" default="/scan" />
  <arg name="laser_frame" default="laser" />

  <!-- laser -> base_link -->
<!-- laser -> base_link: 雷达倒装，绕 Z 轴旋转 180° -->
<node pkg="tf2_ros" type="static_transform_publisher" name="base_to_laser"
      args="0.05 0.0 0.03 0 0 3.1415926 $(arg base_frame) $(arg laser_frame)" />

  <!-- scanmatcher_frame -> base_link (identity) -->
  <node pkg="tf2_ros" type="static_transform_publisher" name="scan_to_base"
        args="0 0 0 0 0 0 1 scanmatcher_frame $(arg base_frame)" />

  <!-- Hector SLAM: 纯激光模式 -->
  <node pkg="hector_mapping" type="hector_mapping" name="hector_mapping" output="screen">
    <param name="map_resolution" value="$(arg map_resolution)" />
    <param name="map_size" value="2048" />

    <param name="map_start_x" value="0.5"/>
    <param name="map_start_y" value="0.5"/>
    <param name="map_pub_period" value="1.0"/>

    <param name="map_frame" value="map" />
    <param name="base_frame" value="$(arg base_frame)" />
    <param name="odom_frame" value="$(arg base_frame)" />  <!-- 关键：等于 base_link -->

    <param name="pub_map_odom_transform" value="true" />   <!-- 不发布 map->odom -->
    <param name="pub_map_scanmatch_transform" value="true" />
    <param name="tf_map_scanmatch_transform_frame_name" value="scanmatcher_frame"/>
    <param name="map_update_frequency" value="8.0" />  <!-- 默认是 4.0 -->


    <param name="scan_topic" value="$(arg laser_topic)" />
    <param name="use_tf_scan_transformation" value="true" />
    <param name="map_update_distance_thresh" value="0.01" />
    <param name="map_update_angle_thresh" value="0.05" />
    <param name="update_factor_free" value="0.4" />
    <param name="update_factor_occupied" value="0.9" />
    <param name="laser_z_min_value" value="-1.0" />
    <param name="laser_z_max_value" value="1.0" />
    <param name="tf_buffer_size" value="10.0" />
    <param name="use_pose_reset" value="false" />
  </node>




<!-- 如果不需要虚拟里程计，请屏蔽这里 -->
  <node pkg="hector_nav_demo" type="tf_to_odom" name="tf_to_odom" output="screen"/>

  <node pkg="move_base" type="move_base" name="move_base" output="screen" clear_params="true"
        launch-prefix="bash -c 'sleep 3; exec $0 $@'">

    <!-- Costmap 参数 -->
    <rosparam file="$(find hector_nav_demo)/config/costmap_common_params.yaml" command="load" ns="global_costmap" />
    <rosparam file="$(find hector_nav_demo)/config/costmap_common_params.yaml" command="load" ns="local_costmap" />
    <rosparam file="$(find hector_nav_demo)/config/global_costmap_params.yaml" command="load" ns="global_costmap" />    
    <rosparam file="$(find hector_nav_demo)/config/local_costmap_params.yaml" command="load" ns="local_costmap" />

    <!-- 全局规划器参数（通常不需要命名空间） -->
    <rosparam file="$(find hector_nav_demo)/config/global_planner.yaml" command="load" />


    <!-- 局部规划器参数 -->
    <!-- <rosparam file="$(find hector_nav_demo)/config/dwa_planner.yaml" command="load"  /> -->

    <!-- move_base 自身参数 -->
    <rosparam file="$(find hector_nav_demo)/config/move_base_params.yaml" command="load" />

    <!-- 插件选择 -->
    <param name="base_global_planner" value="global_planner/GlobalPlanner" />


    <param name="base_local_planner" value="my_planner/MyPlanner" />

    <!-- 坐标系 -->
    <param name="global_costmap/global_frame" value="map" />
    <param name="local_costmap/global_frame" value="map" />
    <param name="global_costmap/robot_base_frame" value="$(arg base_frame)" />
    <param name="local_costmap/robot_base_frame" value="$(arg base_frame)" />

    <!-- 控制频率等 -->
    <param name="controller_frequency" value="10.0" />
    <param name="controller_patience" value="5.0" />
    <param name="planner_patience" value="5.0" />
    <param name="transform_tolerance" value="1" />



    </node> 


  <!-- 运行 costmap_cleaner -->
    <!-- <node pkg="jie_ware" type="costmap_cleaner" name="costmap_cleaner" /> -->

</launch>
